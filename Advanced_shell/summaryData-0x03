#!/bin/bash

DIR="pokemon_data"
OUTPUT="pokemon_report.csv"

echo "Name,Height (m),Weight (kg)" > "$OUTPUT"

TOTAL_HEIGHT=0
TOTAL_WEIGHT=0
COUNT=0

for FILE in "$DIR"/*.json; do
    NAME=$(jq -r '.name' "$FILE" | sed 's/.*/\u&/')
    HEIGHT=$(jq -r '.height' "$FILE")
    WEIGHT=$(jq -r '.weight' "$FILE")
    
    HEIGHT_M=$(awk "BEGIN {print $HEIGHT/10}")
    WEIGHT_KG=$(awk "BEGIN {print $WEIGHT/10}")

    echo "$NAME,$HEIGHT_M,$WEIGHT_KG" >> "$OUTPUT"

    TOTAL_HEIGHT=$(awk "BEGIN {print $TOTAL_HEIGHT+$HEIGHT_M}")
    TOTAL_WEIGHT=$(awk "BEGIN {print $TOTAL_WEIGHT+$WEIGHT_KG}")
    COUNT=$((COUNT+1))
done

AVG_HEIGHT=$(awk "BEGIN {print $TOTAL_HEIGHT/$COUNT}")
AVG_WEIGHT=$(awk "BEGIN {print $TOTAL_WEIGHT/$COUNT}")

echo "CSV Report generated at: $OUTPUT"
echo ""
cat "$OUTPUT"
echo ""
echo "Average Height: $AVG_HEIGHT m"
echo "Average Weight: $AVG_WEIGHT kg"